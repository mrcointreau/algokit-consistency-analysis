name: Pull Request

on:
  pull_request:
    branches:
      - main
    paths-ignore:
      - 'docs/**'

permissions:
  contents: read

jobs:
  build:
    name: 'Build and Test'
    uses: ./.github/workflows/node-ci.yml
    with:
      node-version: 22.x
      run-build: true
      run-commit-lint: true
      audit-script: npm run audit
      # Uncomment if you need AlgoKit localnet for tests:
      # pre-test-script: |
      #   pipx install algokit
      #   algokit localnet start
      #   npx --yes wait-on tcp:4001 -t 30000

  check-docs:
    name: Check docs are up to date
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Use Node.js 22.x
        uses: actions/setup-node@v4
        with:
          node-version: 22.x
          cache: 'npm'

      - name: Install dependencies
        run: npm ci --ignore-scripts

      - name: Generate docs
        run: npm run generate:docs --if-present

      - name: Check for changes
        run: |
          git add -N .
          git diff --exit-code --name-only
